{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Claude Code Session Context v1",
  "description": "Context snapshot from Claude Code CLI sessions for persistence across autocompact events",
  "type": "object",
  "required": [
    "session_id",
    "context_type",
    "timestamp"
  ],
  "additionalProperties": true,
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique identifier for the Claude Code session",
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "context_type": {
      "type": "string",
      "enum": ["autocompact", "checkpoint", "tool", "decision", "summary"],
      "description": "Type of context being captured"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when context was captured"
    },
    "worktree": {
      "type": ["string", "null"],
      "description": "Git worktree path if using worktrees"
    },
    "branch": {
      "type": ["string", "null"],
      "description": "Current git branch name"
    },
    "repository": {
      "type": ["string", "null"],
      "description": "Repository name (e.g., 'PMOVES.AI')"
    },
    "working_directory": {
      "type": ["string", "null"],
      "description": "Current working directory path"
    },
    "summary": {
      "type": ["string", "null"],
      "description": "Human-readable summary of current work context"
    },
    "active_files": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "description": "File path relative to repository root"
          },
          "action": {
            "type": "string",
            "enum": ["read", "edit", "create", "delete"],
            "description": "Last action performed on file"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["path"]
      },
      "description": "Files recently accessed or modified"
    },
    "pending_tasks": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "content": {
            "type": "string",
            "description": "Task description"
          },
          "status": {
            "type": "string",
            "enum": ["pending", "in_progress", "completed", "blocked"]
          },
          "priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          }
        },
        "required": ["content", "status"]
      },
      "description": "Current todo list from TodoWrite"
    },
    "decisions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "question": {
            "type": "string"
          },
          "answer": {
            "type": "string"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["question", "answer"]
      },
      "description": "Decisions made during session (from AskUserQuestion)"
    },
    "tool_executions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "tool": {
            "type": "string",
            "description": "Tool name (e.g., 'Bash', 'Edit', 'Write')"
          },
          "summary": {
            "type": "string",
            "description": "Brief description of what the tool did"
          },
          "success": {
            "type": "boolean"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["tool", "success"]
      },
      "description": "Recent significant tool executions"
    },
    "cgp_geometry": {
      "oneOf": [
        { "type": "null" },
        { "$ref": "../geometry/cgp.v1.schema.json" }
      ],
      "description": "CHIT Geometry Packet for structured knowledge representation"
    },
    "parent_session_id": {
      "type": ["string", "null"],
      "description": "Previous session ID if this is a continuation"
    },
    "agent_spawns": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string"
          },
          "agent_type": {
            "type": "string",
            "description": "Type of agent (e.g., 'Explore', 'Plan', 'general-purpose')"
          },
          "task": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["running", "completed", "failed"]
          }
        },
        "required": ["agent_id", "agent_type", "status"]
      },
      "description": "TAC agents spawned during session"
    },
    "meta": {
      "type": ["object", "null"],
      "additionalProperties": true,
      "description": "Additional metadata"
    }
  }
}
