version: '3.8'

services:
  agent-zero:
    image: frdel/agent-zero:latest
    container_name: agent-zero-gpu
    restart: unless-stopped

    # Use the modern Compose GPU flag (works with NVIDIA Container Toolkit)
    gpus: all
    # For older setups, uncomment instead:
    # runtime: nvidia

    environment:
      # Optional; not required when using `gpus: all`
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - PYTHONUNBUFFERED=1
      - WEB_UI_PORT=5000
      # Keep CUDA device 0 only (optional)
      - CUDA_VISIBLE_DEVICES=0

    ports:
      - "5000:5000"  # Web UI

    volumes:
      - agent_zero_data:/app/data
      - agent_zero_config:/app/config

    # Shared memory for GPU ops
    shm_size: 2g

    privileged: false

volumes:
  agent_zero_data:
  agent_zero_config:

