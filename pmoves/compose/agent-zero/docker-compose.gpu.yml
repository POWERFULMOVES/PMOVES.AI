version: '3.8'

services:
  agent-zero:
    image: frdel/agent-zero:latest
    container_name: agent-zero-gpu
    restart: unless-stopped
    
    # GPU Configuration for RTX 5090
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    
    environment:
      # GPU-specific environment variables
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      
      # Agent Zero configuration
      - PYTHONUNBUFFERED=1
      - WEB_UI_PORT=5000
      
      # Optional: Set specific GPU memory limits
      - CUDA_VISIBLE_DEVICES=0
      
    ports:
      - "5000:5000"  # Web UI
      - "22:22"      # SSH (for development)
      - "80:80"      # Additional services
    
    volumes:
      # Persist data
      - agent_zero_data:/app/data
      - agent_zero_config:/app/config
      
      # Optional: Mount local development files
      # - ./:/app/agent-zero
    
    # Shared memory for GPU operations
    shm_size: '2gb'
    
    # Security context for GPU access
    privileged: false
    
volumes:
  agent_zero_data:
  agent_zero_config:

