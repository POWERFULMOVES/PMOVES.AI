sequenceDiagram
    participant Client as pmoves-yt / Geometry
    participant Routes as _geometry_url_candidates()
    participant Gateway1 as hi-rag-gateway-v2-gpu
    participant Gateway2 as hi-rag-gateway-v2-cpu
    participant Fallback as Derived URLs

    Client->>Routes: Get candidate URLs (from HIRAG_URL)
    Routes->>Routes: Primary: HIRAG_GPU_URL
    Routes->>Fallback: Derive fallback URLs<br/>(port/host variations)
    Routes-->>Client: [GPU_URL, Derived_1, Derived_2, ...]
    loop Try Each Candidate
        Client->>Gateway1: POST geometry event
        alt Success
            Gateway1-->>Client: 200 OK
            Note over Client,Gateway1: Log routing decision if non-primary
        else Failure
            Gateway1-->>Client: Error
            Client->>Gateway2: Try next candidate
        end
    end
