version: "3.9"

services:
  n8n-flows-watcher:
    image: alpine:3.19
    depends_on:
      n8n:
        condition: service_healthy
    environment:
      N8N_BASE_URL: http://n8n:5678
      N8N_USER: ${N8N_BASIC_AUTH_USER:-admin}
      N8N_PASS: ${N8N_BASIC_AUTH_PASSWORD:-adminpass}
    volumes:
      - ./scripts/n8n-flows-watcher.sh:/opt/n8n-flows-watcher.sh:ro
      - ./integrations/health-wger/n8n/flows:/opt/flows/health-wger:ro
      - ./integrations/firefly-iii/n8n/flows:/opt/flows/firefly-iii:ro
    entrypoint: ["/bin/sh","-lc"]
    command: >
      "apk add --no-cache curl jq inotify-tools &&
       sh /opt/n8n-flows-watcher.sh"
    networks: [pmoves]
