<html>
  <head><meta charset="utf-8"><title>PMOVES Retrieval Eval</title></head>
  <body>
    <h3>PMOVES Retrieval Eval</h3>
    <div>
      <label>Namespace <input id="ns" value="pmoves"/></label>
      <button onclick="loadSamples()">Load Samples</button>
    </div>
    <ul id="samples"></ul>
    <hr/>
    <div>
      <label>Query <input id="q" size="50" value="what is pmoves?"/></label>
      <button onclick="runQuery()">Query</button>
    </div>
    <ol id="results"></ol>
    <p>
      Realtime + Supabase UI demo: <a href="/static/realtime.html" target="_blank">Open realtime.html</a>
    </p>
    <script>
      async function loadSamples(){
        const ns = document.getElementById('ns').value;
        const r = await fetch(`/samples?namespace=${encodeURIComponent(ns)}`);
        const j = await r.json();
        const ul = document.getElementById('samples');
        ul.innerHTML = '';
        (j.items||[]).forEach(item=>{
          const li = document.createElement('li');
          li.textContent = `${item.doc_id}/${item.section_id} :: ${item.text}`;
          ul.appendChild(li);
        });
      }
      async function runQuery(){
        const ns = document.getElementById('ns').value;
        const q = document.getElementById('q').value;
        const r = await fetch(`/query?namespace=${encodeURIComponent(ns)}&k=5&q=${encodeURIComponent(q)}`);
        const j = await r.json();
        const ol = document.getElementById('results');
        ol.innerHTML = '';
        (j.hits||[]).forEach(h=>{
          const li = document.createElement('li');
          li.textContent = `${(h.score||0).toFixed(3)} :: ${h.payload?.doc_id}/${h.payload?.section_id} :: ${h.text?.slice(0,120)}`;
          ol.appendChild(li);
        });
      }
      loadSamples();
    </script>
  </body>
</html>
